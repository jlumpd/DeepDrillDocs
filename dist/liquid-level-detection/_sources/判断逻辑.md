
**液面高度监控系统逻辑说明**
##  一、数据预处理模块

###  （一）多级复合滤波

实时接收传感器传入的原始液面高度数据，计算新数据与当前系统记录值的绝对差值。

**1.** **初级滤波：**保留原有阈值滤波逻辑（Δ≤0.5%），过滤无效波动。

**2.** **二级滤波**：引入滑动窗口均值滤波（窗口大小可配置），对连续3个数据点计算均值，平滑瞬时噪声。

**3.** **三级滤波**：针对极端异常值（如数据突变超过10%），触发传感器健康检查，并临时切换至备用传感器数据。优化后，若单次数据突变超过10%，系统立即触发传感器健康检查流程，同时临时切换至备用传感器数据，保障数据的可靠性与连续性，避免因异常数据导致的错误判断。

###  （二）传感器健康监测

**1.** **实时监测稳定性**：若某传感器连续5次数据波动≤0.1%，标记为“疑似故障”，并启用冗余传感器数据交叉验证。优化后，当传感器连续5次波动≤0.1%时，系统将其标记为“低灵敏度”状态，随即启动冗余数据交叉验证机制，通过与冗余传感器数据对比，进一步确认当前传感器数据的准确性。

**2.** **故障自动隔离**：故障确认后，系统自动剔除该传感器数据，并通知维护人员。

##  二、主监控逻辑

###  （一）循环工况监控

#### 1. 总池体积监控

**动态基准值计算：**采用移动时间窗口算法（时间窗口大小由系统界面输入，默认1分钟），计算窗口内总池体积的平均值作为动态基准值。优化后，采用加权移动平均算法计算动态基准值，在时间窗口内，赋予最近10秒数据60%的权重，强化对短期趋势的捕捉与响应能力，使基准值能更及时地反映液面的实时变化；同时依据实时采集的温度、压力数据，通过预先设定的补偿系数表对液面高度值进行修正，消除环境因素对液面高度测量的影响，提高测量精度。

**设定动态阈值：**上限阈值为基准值×102%；下限阈值为基准值×98%。优化后，若连续10分钟液面稳定（波动<1%），系统自动收紧阈值至基准值的±1%，提高监测的灵敏度；当液面波动加剧时，阈值则恢复至默认设置，平衡误报与漏报风险。

**判定规则：**当前总池体积超过上限阈值时，触发“溢流”警报；低于下限阈值时，触发“漏失”警报；在阈值范围内波动时标记为“稳定”。

###  （二）起钻工况监控

#### 1. 总池体积监控

**输入参数**：理论体积变化量是根据起钻时钻具移除体积计算的理论液面下降量（ΔV理论）；允许偏差范围为ΔV理论×20%。优化后，结合泵速、钻具运动速度等参数，实时校准理论体积变化量（ΔV理论），使理论计算更加贴合实际工况，提升监控准确性。

**计算与判定：**实时计算实际体积变化量（ΔV实际）与变化速率，若ΔV实际 < ΔV理论 - 允许偏差 → 触发“漏失”警报（液面下降过快）；若ΔV实际 > ΔV理论 + 允许偏差 → 触发“溢流”警报（液面下降不足或上升）。优化后，若连续3次实际体积变化量（ΔV实际）超出允许偏差范围，系统触发高优先级警报，提示操作人员及时处理潜在风险。

#### 2. 时间关联监控

若到达计划起钻时间（T）后，体积减少量仍小于理论体积减少量，即ΔV实际（最终）>ΔV理论,则系统判别为溢流。优化后，在计划时间T到达后，将监测时间延长至T+30秒，更全面地观察体积变化情况，避免因短暂波动导致的误判；当ΔV实际与ΔV理论差值>5%时，触发“严重溢流”警报；差值≤5%时，触发“轻度溢流”警报，便于操作人员快速判断风险程度并采取相应措施。

###  （三）下钻工况监控

#### 1. 总池体积监控

**输入参数**：理论体积变化量是根据下钻时钻具插入体积计算的理论液面上升量（ΔV理论）；允许偏差范围为ΔV理论×20%。优化后，结合泵速、钻具运动速度等参数，实时校准理论体积变化量（ΔV理论），使理论计算更加贴合实际工况，提升监控准确性。

**计算与判定**：实时计算实际体积变化量（ΔV实际）与变化速率，若ΔV实际 > ΔV理论 + 允许偏差 → 触发“溢流”警报（液面上升过快）；若ΔV实际 < ΔV理论 - 允许偏差 → 触发“漏失”警报（液面上升不足或下降）。优化后，若连续3次实际体积变化量（ΔV实际）超出允许偏差范围，系统触发高优先级警报，提示操作人员及时处理潜在风险。

#### 2. 时间关联监控

若到达计划起钻时间（T）后，体积增加量仍未到达理论体积增加量，即ΔV实际（最终）<ΔV理论,则系统判别为漏失。优化后，在计划时间T到达后，将监测时间延长至T+30秒，更全面地观察体积变化情况，避免因短暂波动导致的误判；当ΔV实际与ΔV理论差值>5%时，触发“严重漏失”警报；差值≤5%时，触发“轻度漏失”警报，便于操作人员快速判断风险程度并采取相应措施。

##  三、单罐液面变化速率监控

###  （一）通用监控规则

实时计算每个泥浆罐的液面高度变化速率（单位：%/s），判定等级如下：

**1.** **稳定：**速率 < 0.5%/s，仅记录数据；

**2.** **稳定上升****/****下降**：速率0.5%~2%/s；

**3.** **快速上升****/****下降：**速率 > 2%/s，触发警报；

以上变化速率范围阈值可调整。优化后，运用线性回归算法，基于滑动窗口（5秒）数据预测未来5秒的液面高度变化速率。若预测值>2%/s，系统提前触发预警，为操作人员争取更多处理时间。

###  （二）多罐协同判定

若同一时间内≥2个罐体触发“快速变化”警报，则升级为系统级溢流/漏失警报。优化后，实行分级响应机制，当2个罐体报警时，触发系统级警报并启动备用监测模块；当≥3个罐体报警时，触发紧急停机指令，关闭相关阀门，防止事故扩大；

##  四、新增智能功能模块

###  （一）智能诊断与根因分析

**1.** **事件关联图谱**：自动分析警报前后10分钟数据，标记关联异常参数（如泵压突降+液面上升）。

**2.** **根因推荐库**：基于历史案例，提供可能故障原因（如“钻井液加重”“传感器数据紊乱”）。

###  （二）可视化与交互优化

**1.** **液面分布图**：实时展示各罐高度、变化趋势及报警状态。

**2.** **警报历史分析**：按时间段统计报警频率，辅助优化阈值配置。

###  （三）自适应学习模块

**1.** **工况模式学习**：通过历史数据训练，识别不同工况（如循环、起下钻）下的液面波动模式。

**2.** **参数自优化：**定期生成调整建议（如“建议起钻允许偏差至15%”）。

##  五、系统容错与运维支持

###  （一）全链路日志管理

记录原始数据、滤波结果、判定过程及操作指令，支持按时间/事件类型回溯。

###  （二）模拟演练模式

支持注入模拟数据（如快速漏失、传感器故障），验证系统响应逻辑。